JSONGEN_VERSION = @PACKAGE_VERSION@

SOURCES = $(notdir $(wildcard src/*.erl)) jsg_regexp_parser.erl
BEAMS = $(patsubst %.erl,ebin/%.beam,$(SOURCES))

EFLAGS = +debug_info

all: ebin $(BEAMS)

clean:
	rm ebin/*.beam

src/jsg_regexp_parser.erl: src/jsg_regexp_parser.yrl
	(cd src; erl -noshell -run yecc file jsg_regexp_parser.yrl -run erlang halt)

ebin/%.beam: src/%.erl
	erlc $(EFLAGS) -o ebin $<

ebin:
	mkdir -p ebin

docs:
	make edoc

edoc: 
	mkdir -p doc/doc
	cp doc/overview.edoc doc/doc
	erl -noshell -run edoc_run files '["src/jsongen.erl", "src/jsg_json_validate.erl"]' '[{sort_functions,false},{dir,"doc/doc"}]'

dialyzer:
	dialyzer ebin/*beam

release: main docs examples
	@ scripts/mkrelease "." release $(JSONGEN_VERSION)

dotest:
	erl -pa ebin -noshell -run rtest test -run erlang halt
